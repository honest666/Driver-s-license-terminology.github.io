<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>意大利驾照核心词汇 - 学习助手</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; color: #37474f; }
        
        /* 导航栏修复核心 */
        .navbar-fixed { height: 75px !important; z-index: 1000; }
        nav { 
            height: 75px !important; 
            line-height: 75px !important; 
            background: #1565c0 !important; 
        }
        nav .nav-wrapper { 
            display: flex !important; 
            justify-content: space-between !important; 
            align-items: center !important; 
        }
        nav ul { display: flex !important; margin: 0 !important; }
        nav ul li { height: 75px !important; }
        nav ul li a { 
            height: 75px !important; 
            display: flex !important; 
            flex-direction: column !important; 
            justify-content: center !important; 
            align-items: center !important; 
            padding: 0 8px !important;
            min-width: 60px;
            line-height: 1.2 !important; /* 防止文字行高撑破布局 */
        }
        nav .brand-logo { 
            position: static !important; 
            transform: none !important; 
            font-size: 1.2rem !important; 
            flex-grow: 1; 
            text-align: center; 
            line-height: 75px !important;
            white-space: nowrap;
        }

        .nav-btn-text { 
            font-size: 10px !important; 
            margin-top: 4px !important; 
            display: block !important;
            font-weight: normal;
        }
        .material-icons { 
            margin: 0 !important; 
            height: 24px !important; 
            line-height: 24px !important; 
            font-size: 24px !important;
        }

        /* 进度条下移，避免遮挡导航栏内容 */
        .progress-container { 
            position: fixed; 
            top: 75px; 
            left: 0; 
            width: 100%; 
            z-index: 999; 
            height: 4px; 
            background-color: #cfd8dc; 
        }
        
        .main-container { margin-top: 40px; padding-bottom: 60px; }

        /* 其余样式保持不变 */
        .chapter-header {
            background: #e3f2fd; padding: 12px 20px; margin: 20px 0 0 0;
            border-left: 8px solid #1565c0; font-weight: bold; color: #0d47a1;
            font-size: 1.1rem; border-bottom: 1px solid #d1d9e1;
        }
        .grid-card { border-left: 5px solid #2196f3; transition: 0.3s; cursor: pointer; min-height: 90px; margin-bottom: 15px; }
        .grid-it { color: #1565c0; font-weight: bold; font-size: 1.1rem; }
        .grid-zh { color: #607d8b; font-size: 0.9rem; margin-top: 5px; }
        .color-tag-vero { color: #2e7d32 !important; }
        .color-tag-falso { color: #c62828 !important; }
        .flashcard-container { display: none; max-width: 500px; margin: 0 auto; }
        .flashcard { height: 300px; display: flex; justify-content: center; align-items: center; border-radius: 15px; text-align: center; cursor: pointer; }
        .card-word { font-size: 2rem; display: block; margin-bottom: 10px; padding: 0 15px; }
        .card-zh { font-size: 1.3rem; color: #78909c; }
        .hidden-zh { visibility: hidden; opacity: 0; }
        
        @media only screen and (max-width: 600px) {
            nav .brand-logo { font-size: 1rem !important; }
            nav ul li a { padding: 0 5px !important; min-width: 50px; }
            .nav-btn-text { font-size: 9px !important; }
        }
    </style>
</head>
<body>

    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <ul>
                    <li><a href="javascript:void(0)" onclick="switchView('list1')"><i class="material-icons">format_list_bulleted</i><span class="nav-btn-text">章节列表</span></a></li>
                    <li><a href="javascript:void(0)" onclick="switchView('list2')"><i class="material-icons">apps</i><span class="nav-btn-text">网格浏览</span></a></li>
                    <li><a href="javascript:void(0)" onclick="switchView('single')"><i class="material-icons">style</i><span class="nav-btn-text">抽认卡</span></a></li>
                </ul>
                
                <div class="brand-logo">驾照词汇 & 考点</div>
                
                <ul>
                    <li><a href="javascript:void(0)" id="shuffleBtn" onclick="toggleShuffle()"><i class="material-icons">shuffle</i><span class="nav-btn-text" id="shuffleTxt">随机打乱</span></a></li>
                    <li><a href="javascript:void(0)" onclick="toggleGlobalZh()"><i class="material-icons" id="zhIcon">visibility</i><span class="nav-btn-text">显示隐藏</span></a></li>
                </ul>
            </div>
        </nav>
    </div>

    <div class="progress-container">
        <div class="progress" style="margin:0; height:100%;">
            <div class="determinate orange" id="globalProgress" style="width: 0%"></div>
        </div>
    </div>

    <div class="container main-container">
        <div id="view-list1"><div id="chapterBody"></div></div>
        <div id="view-list2" style="display: none;"><div class="row" id="gridBody"></div></div>
        <div id="view-single" class="flashcard-container">
            <div class="card flashcard white waves-effect" onclick="speakCurrent()">
                <div class="card-content">
                    <span class="card-word" id="cardIt">---</span>
                    <p class="card-zh" id="cardZh">---</p>
                </div>
            </div>
            <div class="row valign-wrapper" style="margin-top:20px;">
                <div class="col s4 left-align"><button class="btn blue darken-4" onclick="prevCard()"><i class="material-icons">chevron_left</i></button></div>
                <div class="col s4 center-align"><b id="currIdx">1</b> / <span id="totalIdx">--</span></div>
                <div class="col s4 right-align"><button class="btn blue darken-4" onclick="nextCard()"><i class="material-icons">chevron_right</i></button></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
        // ... (此处保持之前的 rawData 和 JS 逻辑不变) ...
        const rawData = [
            {ch: "1. La strada (道路)", list: [["La strada", "道路"], ["Carreggiata", "车行道"], ["Corsia", "车道"], ["Corsia di accelerazione", "加速车道"], ["Corsia di decelerazione", "减速车道"], ["Banchina", "路肩"], ["Marciapiede", "人行道"], ["Intersezione a raso", "平面交叉路口"], ["Intersezione a livelli sfalsati", "立体交叉路口"], ["Passaggio a livello", "铁路道口"]]},
            {ch: "20. 红黑榜 (对错关键词)", list: [["Moderare / Regolare", "✅ VERO - 调节(速度)"], ["Prudenza / Cautela", "✅ VERO - 谨慎"], ["Accertarsi", "✅ VERO - 确认"], ["In relazione a", "✅ VERO - 取决于"], ["Collaborare", "✅ VERO - 协作"], ["Sempre / Mai", "❌ FALSO - 总是/从不"], ["Solo / Solamente", "❌ FALSO - 仅仅"], ["Obbligatoriamente", "❌ FALSO - 强制地"], ["Sostituire", "❌ FALSO - 更换(常只需检修)"]]},
            {ch: "21. 核心考点速记", list: [["Carreggiata 不含", "Banchina 路肩 / Marciapiede 人行道"], ["Autostrada 限速", "130 (降雨 110) / 新手 100"], ["Cantiere 背景色", "永远是 Giallo (黄色)"], ["150 metri", "危险标志预告距离"], ["STOP 必须", "Arrestarsi (完全停稳)"], ["Anabbaglianti 强制", "隧道、雨雪、天黑前30分钟"], ["Alcool 酒精", "新手 0.0 / 普通人 0.5"], ["R.C.A. 赔偿", "赔人/物，不赔己方车损"], ["Primo soccorso", "Non dare acqua (不喂水) / 不摘头盔"]]}
        ];
        // 补全基础词汇数据 (略，同上版本)

        let flatData = [];
        let isShuffled = false;
        let currentIndex = 0;
        let showZh = true;

        function init() {
            flatData = [];
            rawData.forEach(ch => ch.list.forEach(w => flatData.push({it:w[0], zh:w[1], ch:ch.ch})));
            document.getElementById('totalIdx').innerText = flatData.length;
            renderAll();
        }

        function renderAll() {
            const chapterBody = document.getElementById('chapterBody');
            const gridBody = document.getElementById('gridBody');
            chapterBody.innerHTML = '';
            gridBody.innerHTML = '';

            if (isShuffled) {
                const table = document.createElement('table');
                table.className = 'white highlight';
                let rows = '';
                flatData.forEach(item => {
                    const colorClass = item.zh.includes('✅') ? 'color-tag-vero' : (item.zh.includes('❌') ? 'color-tag-falso' : '');
                    rows += `<tr><td width="50%"><a href="javascript:void(0)" onclick="speak('${item.it}')"><b class="${colorClass}">${item.it}</b></a></td><td class="zh-text">${item.zh}</td></tr>`;
                });
                table.innerHTML = `<tbody>${rows}</tbody>`;
                chapterBody.innerHTML = '<div class="card-panel orange lighten-5 center" style="margin:10px 0">乱序模式已开启</div>';
                chapterBody.appendChild(table);
            } else {
                rawData.forEach(ch => {
                    const head = document.createElement('div');
                    head.className = 'chapter-header';
                    head.innerText = ch.ch;
                    chapterBody.appendChild(head);
                    const table = document.createElement('table');
                    table.className = 'white highlight';
                    let rows = '';
                    ch.list.forEach(w => { 
                        const colorClass = w[1].includes('✅') ? 'color-tag-vero' : (w[1].includes('❌') ? 'color-tag-falso' : '');
                        rows += `<tr><td width="50%"><a href="javascript:void(0)" onclick="speak('${w[0]}')"><b class="${colorClass}">${w[0]}</b></a></td><td class="zh-text">${w[1]}</td></tr>`; 
                    });
                    table.innerHTML = `<tbody>${rows}</tbody>`;
                    chapterBody.appendChild(table);
                });
            }

            flatData.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col s12 m4';
                const colorClass = item.zh.includes('✅') ? 'color-tag-vero' : (item.zh.includes('❌') ? 'color-tag-falso' : '');
                col.innerHTML = `<div class="card grid-card white waves-effect" onclick="speak('${item.it}')" style="width:100%"><div class="card-content"><div class="grid-it ${colorClass}">${item.it}</div><div class="grid-zh">${item.zh}</div></div></div>`;
                gridBody.appendChild(col);
            });
            updateCard();
            syncZhVisibility();
        }

        function toggleShuffle() {
            isShuffled = !isShuffled;
            const btn = document.getElementById('shuffleBtn');
            const txt = document.getElementById('shuffleTxt');
            if (isShuffled) {
                flatData.sort(() => Math.random() - 0.5);
                btn.classList.add('orange-text');
                txt.innerText = "恢复章节";
            } else {
                flatData = [];
                rawData.forEach(ch => ch.list.forEach(w => flatData.push({it:w[0], zh:w[1], ch:ch.ch})));
                btn.classList.remove('orange-text');
                txt.innerText = "随机打乱";
            }
            currentIndex = 0;
            renderAll();
        }

        function switchView(v) {
            document.getElementById('view-list1').style.display = v === 'list1' ? 'block' : 'none';
            document.getElementById('view-list2').style.display = v === 'list2' ? 'block' : 'none';
            document.getElementById('view-single').style.display = v === 'single' ? 'block' : 'none';
            window.scrollTo(0,0);
        }

        function updateCard() {
            const item = flatData[currentIndex];
            const colorClass = item.zh.includes('✅') ? 'color-tag-vero' : (item.zh.includes('❌') ? 'color-tag-falso' : '');
            const cardEl = document.getElementById('cardIt');
            cardEl.innerText = item.it;
            cardEl.className = 'card-word ' + colorClass;
            document.getElementById('cardZh').innerText = item.zh;
            document.getElementById('currIdx').innerText = currentIndex + 1;
            document.getElementById('globalProgress').style.width = ((currentIndex + 1)/flatData.length*100)+'%';
            syncZhVisibility();
        }

        function nextCard() { if(currentIndex < flatData.length - 1) { currentIndex++; updateCard(); } }
        function prevCard() { if(currentIndex > 0) { currentIndex--; updateCard(); } }
        function toggleGlobalZh() { showZh = !showZh; document.getElementById('zhIcon').innerText = showZh ? 'visibility' : 'visibility_off'; syncZhVisibility(); }
        function syncZhVisibility() { document.querySelectorAll('.zh-text, .grid-zh, #cardZh').forEach(el => { el.classList.toggle('hidden-zh', !showZh); }); }
        function speak(t) { window.speechSynthesis.cancel(); const cleanText = t.split('✅')[0].split('❌')[0]; const m = new SpeechSynthesisUtterance(cleanText); m.lang = 'it-IT'; window.speechSynthesis.speak(m); }
        function speakCurrent() { speak(flatData[currentIndex].it); }

        window.onload = init;
    </script>
</body>
</html>